# ä¹å®«æ ¼æŠ½å¥– - å®ç‰©å¥–å“æ ¸é”€åŠŸèƒ½å®ç°æ–¹æ¡ˆ

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

å°†ä¹å®«æ ¼æŠ½å¥–ä¸­çš„ 4 ä¸ªå¥–é¡¹æ”¹ä¸ºçº¿ä¸‹å…‘æ¢çš„å®ç‰©å¥–å“ï¼Œéœ€è¦ç®¡ç†å‘˜æ ¸é”€åŠŸèƒ½ã€‚

### æ ¸å¿ƒéœ€æ±‚
1. âœ… 4 ä¸ªå¥–é¡¹æ”¹ä¸ºå®ç‰©å¥–å“ï¼ˆéç§¯åˆ†å¥–åŠ±ï¼‰
2. âœ… ç”¨æˆ·ä¸­å¥–åè®°å½•å¾…æ ¸é”€çŠ¶æ€
3. âœ… ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å¾…æ ¸é”€åˆ—è¡¨
4. âœ… ç®¡ç†å‘˜å¯ä»¥æ ¸é”€å¥–å“ï¼ˆæ ‡è®°ä¸ºå·²å…‘æ¢ï¼‰
5. âœ… ç”¨æˆ·å¯ä»¥çœ‹åˆ°è‡ªå·±çš„å¾…æ ¸é”€/å·²æ ¸é”€è®°å½•

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### 1. æ•°æ®æ¨¡å‹è®¾è®¡

#### 1.1 æ‰©å±•å¥–é¡¹ç±»å‹

```typescript
// å¥–å“ç±»å‹æšä¸¾
type PrizeType = 'reward' | 'nothing' | 'bonus' | 'physical'; // æ–°å¢ 'physical'

// å¥–å“é…ç½®
interface Prize {
  name: string;
  type: PrizeType;
  reward: number;        // ç§¯åˆ†å¥–åŠ±ï¼ˆphysical ç±»å‹ä¸º 0ï¼‰
  probability: number;
  physicalPrize?: {      // å®ç‰©å¥–å“ä¿¡æ¯ï¼ˆä»… physical ç±»å‹ï¼‰
    description: string;  // å¥–å“æè¿°
    imageUrl?: string;   // å¥–å“å›¾ç‰‡
    stock?: number;      // åº“å­˜ï¼ˆå¯é€‰ï¼‰
  };
}
```

#### 1.2 æ‰©å±•æ¸¸æˆè®°å½•

```typescript
// ä¿®æ”¹ LotteryGameRecord æ¥å£
export interface LotteryGameRecord {
  _id?: any;
  uid: number;
  domainId: string;
  bet: number;
  prizeIndex: number;
  prizeName: string;
  prizeType: 'reward' | 'nothing' | 'bonus' | 'physical'; // æ–°å¢
  reward: number;
  netGain: number;
  gameTime: Date;
  
  // æ–°å¢å­—æ®µï¼šå®ç‰©å¥–å“æ ¸é”€ç›¸å…³
  physicalPrize?: {
    description: string;
    imageUrl?: string;
  };
  redeemStatus?: 'pending' | 'redeemed' | 'cancelled'; // æ ¸é”€çŠ¶æ€
  redeemedAt?: Date;      // æ ¸é”€æ—¶é—´
  redeemedBy?: number;    // æ ¸é”€ç®¡ç†å‘˜UID
  redeemNote?: string;    // æ ¸é”€å¤‡æ³¨
}
```

#### 1.3 æ–°å¢æ ¸é”€è®°å½•é›†åˆï¼ˆå¯é€‰ï¼Œç”¨äºå®¡è®¡ï¼‰

```typescript
// lottery.redemptions é›†åˆ
interface RedemptionRecord {
  _id?: any;
  recordId: any;          // å…³è”çš„ lottery.records._id
  uid: number;            // ä¸­å¥–ç”¨æˆ·
  domainId: string;
  prizeName: string;
  prizeDescription: string;
  redeemedAt: Date;
  redeemedBy: number;     // ç®¡ç†å‘˜UID
  redeemNote?: string;
  status: 'redeemed' | 'cancelled';
}
```

---

## ğŸ”„ æ ¸å¿ƒæµç¨‹è®¾è®¡

### 2.1 ç”¨æˆ·æŠ½å¥–æµç¨‹ï¼ˆä¿®æ”¹ï¼‰

```typescript
// LotteryService.playLottery() ä¿®æ”¹
async playLottery(domainId: string, uid: number) {
  // ... å‰é¢çš„æ£€æŸ¥é€»è¾‘ä¸å˜ ...
  
  const prize = LotteryService.PRIZES[prizeIndex];
  
  // è®¡ç®—å‡€æ”¶ç›Š
  let netGain = -LotteryService.BET_AMOUNT;
  let finalReward = 0;
  
  if (prize.type === 'reward') {
    // ç§¯åˆ†å¥–åŠ±ï¼šç«‹å³å‘æ”¾
    finalReward = prize.reward;
    netGain += prize.reward;
  } else if (prize.type === 'physical') {
    // å®ç‰©å¥–å“ï¼šä¸å‘æ”¾ç§¯åˆ†ï¼Œè®°å½•å¾…æ ¸é”€çŠ¶æ€
    finalReward = 0;
    // netGain ä¿æŒ -50ï¼ˆåªæ‰£é™¤æŠ•æ³¨ï¼‰
  } else if (prize.type === 'bonus') {
    // å†æ¥ä¸€æ¬¡
    finalReward = 0;
    netGain = 0;
  } else {
    // nothing
    finalReward = 0;
  }
  
  // ä¿å­˜æ¸¸æˆè®°å½•
  const gameRecord: Omit<LotteryGameRecord, '_id'> = {
    uid,
    domainId,
    bet: LotteryService.BET_AMOUNT,
    prizeIndex,
    prizeName: prize.name,
    prizeType: prize.type,
    reward: finalReward,
    netGain,
    gameTime: new Date(),
    
    // å¦‚æœæ˜¯å®ç‰©å¥–å“ï¼Œæ·»åŠ æ ¸é”€çŠ¶æ€
    ...(prize.type === 'physical' ? {
      physicalPrize: prize.physicalPrize,
      redeemStatus: 'pending', // å¾…æ ¸é”€
    } : {}),
  };
  
  const recordResult = await this.ctx.db.collection('lottery.records' as any)
    .insertOne(gameRecord);
  
  // æ‰£é™¤æŠ•æ³¨ç§¯åˆ†ï¼ˆæ‰€æœ‰ç±»å‹éƒ½éœ€è¦ï¼‰
  await this.scoreService.updateUserScore(domainId, uid, -LotteryService.BET_AMOUNT);
  await this.scoreService.addScoreRecord({
    uid,
    domainId,
    pid: uniquePid,
    recordId: recordResult.insertedId,
    score: -LotteryService.BET_AMOUNT,
    reason: `ä¹å®«æ ¼æŠ½å¥–æŠ•æ³¨${LotteryService.BET_AMOUNT}ç§¯åˆ†`,
    category: ScoreCategory.GAME_ENTERTAINMENT,
    title: 'ä¹å®«æ ¼æŠ½å¥–',
  });
  
  // åªæœ‰ç§¯åˆ†å¥–åŠ±æ‰å‘æ”¾ç§¯åˆ†
  if (prize.type === 'reward' && finalReward > 0) {
    await this.scoreService.updateUserScore(domainId, uid, finalReward);
    await this.scoreService.addScoreRecord({
      uid,
      domainId,
      pid: uniquePid - 1,
      recordId: recordResult.insertedId,
      score: finalReward,
      reason: `ä¹å®«æ ¼æŠ½å¥–è·å¾—${prize.name}`,
      category: ScoreCategory.GAME_ENTERTAINMENT,
      title: 'ä¹å®«æ ¼æŠ½å¥–',
    });
  }
  
  // å®ç‰©å¥–å“ä¸éœ€è¦å‘æ”¾ç§¯åˆ†ï¼Œä½†éœ€è¦è®°å½•åˆ°æ ¸é”€ç³»ç»Ÿ
  
  // ... æ›´æ–°ç»Ÿè®¡é€»è¾‘ ...
}
```

### 2.2 ç®¡ç†å‘˜æ ¸é”€æµç¨‹

```typescript
// æ–°å¢ LotteryRedemptionService
class LotteryRedemptionService {
  /**
   * è·å–å¾…æ ¸é”€åˆ—è¡¨
   */
  async getPendingRedemptions(
    domainId: string,
    page: number = 1,
    limit: number = 20,
    filters?: {
      uid?: number;
      prizeName?: string;
    }
  ) {
    const skip = (page - 1) * limit;
    const query: any = {
      domainId,
      prizeType: 'physical',
      redeemStatus: 'pending',
    };
    
    if (filters?.uid) query.uid = filters.uid;
    if (filters?.prizeName) query.prizeName = { $regex: filters.prizeName };
    
    const records = await this.ctx.db.collection('lottery.records' as any)
      .find(query)
      .sort({ gameTime: -1 })
      .skip(skip)
      .limit(limit)
      .toArray();
    
    const total = await this.ctx.db.collection('lottery.records' as any)
      .countDocuments(query);
    
    return {
      records,
      total,
      page,
      totalPages: Math.ceil(total / limit),
    };
  }
  
  /**
   * æ ¸é”€å¥–å“
   */
  async redeemPrize(
    domainId: string,
    recordId: any,
    adminUid: number,
    note?: string
  ) {
    // æŸ¥æ‰¾è®°å½•
    const record = await this.ctx.db.collection('lottery.records' as any)
      .findOne({ _id: recordId, domainId, prizeType: 'physical' });
    
    if (!record) {
      throw new Error('è®°å½•ä¸å­˜åœ¨');
    }
    
    if (record.redeemStatus !== 'pending') {
      throw new Error('è¯¥å¥–å“å·²æ ¸é”€æˆ–å·²å–æ¶ˆ');
    }
    
    // æ›´æ–°æ ¸é”€çŠ¶æ€
    await this.ctx.db.collection('lottery.records' as any).updateOne(
      { _id: recordId },
      {
        $set: {
          redeemStatus: 'redeemed',
          redeemedAt: new Date(),
          redeemedBy: adminUid,
          redeemNote: note || '',
        },
      }
    );
    
    // å¯é€‰ï¼šåˆ›å»ºæ ¸é”€è®°å½•ï¼ˆç”¨äºå®¡è®¡ï¼‰
    await this.ctx.db.collection('lottery.redemptions' as any).insertOne({
      recordId,
      uid: record.uid,
      domainId,
      prizeName: record.prizeName,
      prizeDescription: record.physicalPrize?.description || '',
      redeemedAt: new Date(),
      redeemedBy: adminUid,
      redeemNote: note,
      status: 'redeemed',
    });
    
    return { success: true };
  }
  
  /**
   * å–æ¶ˆæ ¸é”€ï¼ˆæ’¤é”€ï¼‰
   */
  async cancelRedemption(
    domainId: string,
    recordId: any,
    adminUid: number,
    note?: string
  ) {
    const record = await this.ctx.db.collection('lottery.records' as any)
      .findOne({ _id: recordId, domainId });
    
    if (!record || record.redeemStatus !== 'pending') {
      throw new Error('æ— æ³•å–æ¶ˆæ ¸é”€');
    }
    
    await this.ctx.db.collection('lottery.records' as any).updateOne(
      { _id: recordId },
      {
        $set: {
          redeemStatus: 'cancelled',
          redeemedAt: new Date(),
          redeemedBy: adminUid,
          redeemNote: note || 'ç®¡ç†å‘˜å–æ¶ˆ',
        },
      }
    );
    
    return { success: true };
  }
  
  /**
   * è·å–ç”¨æˆ·çš„æ‰€æœ‰æ ¸é”€è®°å½•
   */
  async getUserRedemptions(
    domainId: string,
    uid: number,
    status?: 'pending' | 'redeemed' | 'cancelled'
  ) {
    const query: any = {
      domainId,
      uid,
      prizeType: 'physical',
    };
    
    if (status) {
      query.redeemStatus = status;
    }
    
    return await this.ctx.db.collection('lottery.records' as any)
      .find(query)
      .sort({ gameTime: -1 })
      .toArray();
  }
}
```

---

## ğŸ¨ å‰ç«¯ç•Œé¢è®¾è®¡

### 3.1 ç”¨æˆ·ç«¯ - æˆ‘çš„å¥–å“é¡µé¢

**è·¯ç”±**: `/score/lottery/my-prizes`

**åŠŸèƒ½**:
- æ˜¾ç¤ºæ‰€æœ‰å®ç‰©å¥–å“è®°å½•
- æŒ‰çŠ¶æ€ç­›é€‰ï¼šå¾…æ ¸é”€ / å·²æ ¸é”€ / å·²å–æ¶ˆ
- æ˜¾ç¤ºå¥–å“ä¿¡æ¯ã€ä¸­å¥–æ—¶é—´ã€æ ¸é”€æ—¶é—´ç­‰

**ç»„ä»¶ç»“æ„**:
```tsx
<MyPrizesPage>
  <Tabs>
    <TabPane key="pending" tab="å¾…æ ¸é”€">
      <PrizeList status="pending" />
    </TabPane>
    <TabPane key="redeemed" tab="å·²æ ¸é”€">
      <PrizeList status="redeemed" />
    </TabPane>
  </Tabs>
</MyPrizesPage>
```

### 3.2 ç®¡ç†å‘˜ç«¯ - æ ¸é”€ç®¡ç†é¡µé¢

**è·¯ç”±**: `/score/lottery/admin/redeem`

**åŠŸèƒ½**:
- æ˜¾ç¤ºæ‰€æœ‰å¾…æ ¸é”€è®°å½•
- æ”¯æŒæœç´¢ï¼ˆç”¨æˆ·åã€å¥–å“åç§°ï¼‰
- ä¸€é”®æ ¸é”€åŠŸèƒ½
- æ˜¾ç¤ºæ ¸é”€å†å²

**ç»„ä»¶ç»“æ„**:
```tsx
<RedemptionAdminPage>
  <Card title="å¾…æ ¸é”€åˆ—è¡¨">
    <Table
      dataSource={pendingRedemptions}
      columns={[
        { title: 'ç”¨æˆ·', dataIndex: 'username' },
        { title: 'å¥–å“', dataIndex: 'prizeName' },
        { title: 'ä¸­å¥–æ—¶é—´', dataIndex: 'gameTime' },
        { title: 'æ“ä½œ', render: (_, record) => (
          <Button onClick={() => handleRedeem(record._id)}>æ ¸é”€</Button>
        )},
      ]}
    />
  </Card>
  
  <Card title="æ ¸é”€å†å²">
    <Table dataSource={redeemedHistory} />
  </Card>
</RedemptionAdminPage>
```

### 3.3 æŠ½å¥–ç»“æœå±•ç¤ºï¼ˆä¿®æ”¹ï¼‰

åœ¨æŠ½å¥–ç»“æœä¸­ï¼Œå¦‚æœæ˜¯å®ç‰©å¥–å“ï¼Œæ˜¾ç¤ºä¸åŒçš„æç¤ºï¼š

```tsx
{gameResult.prizeType === 'physical' && (
  <Alert
    message="æ­å–œè·å¾—å®ç‰©å¥–å“ï¼"
    description="è¯·å‰å¾€ã€Œæˆ‘çš„å¥–å“ã€é¡µé¢æŸ¥çœ‹è¯¦æƒ…ï¼Œå¹¶è”ç³»ç®¡ç†å‘˜æ ¸é”€"
    type="success"
    action={
      <Button href="/score/lottery/my-prizes">æŸ¥çœ‹æˆ‘çš„å¥–å“</Button>
    }
  />
)}
```

---

## ğŸ“ å®ç°æ­¥éª¤

### é˜¶æ®µ 1: æ•°æ®æ¨¡å‹å’Œæ ¸å¿ƒé€»è¾‘

1. **ä¿®æ”¹å¥–é¡¹é…ç½®**
   - åœ¨ `LotteryService.ts` ä¸­ä¿®æ”¹ `PRIZES` æ•°ç»„
   - å°† 4 ä¸ªå¥–é¡¹æ”¹ä¸º `type: 'physical'`
   - æ·»åŠ  `physicalPrize` ä¿¡æ¯

2. **æ‰©å±•æ•°æ®æ¥å£**
   - ä¿®æ”¹ `LotteryGameRecord` æ¥å£
   - æ·»åŠ æ ¸é”€ç›¸å…³å­—æ®µ

3. **ä¿®æ”¹æŠ½å¥–é€»è¾‘**
   - æ›´æ–° `playLottery()` æ–¹æ³•
   - å¤„ç†å®ç‰©å¥–å“ç±»å‹

### é˜¶æ®µ 2: æ ¸é”€æœåŠ¡

4. **åˆ›å»ºæ ¸é”€æœåŠ¡**
   - æ–°å»º `LotteryRedemptionService.ts`
   - å®ç°æ ¸é”€ç›¸å…³æ–¹æ³•

5. **åˆ›å»ºæ ¸é”€å¤„ç†å™¨**
   - æ–°å»º `LotteryRedemptionHandlers.ts`
   - å®ç° API ç«¯ç‚¹

### é˜¶æ®µ 3: å‰ç«¯ç•Œé¢

6. **ç”¨æˆ·ç«¯ - æˆ‘çš„å¥–å“é¡µé¢**
   - åˆ›å»º `lottery-my-prizes.page.tsx`
   - æ˜¾ç¤ºç”¨æˆ·å¥–å“åˆ—è¡¨

7. **ç®¡ç†å‘˜ç«¯ - æ ¸é”€ç®¡ç†é¡µé¢**
   - åˆ›å»º `lottery-redemption-admin.page.tsx`
   - å®ç°æ ¸é”€æ“ä½œç•Œé¢

8. **ä¿®æ”¹æŠ½å¥–é¡µé¢**
   - æ›´æ–° `lottery-game.page.tsx`
   - å¤„ç†å®ç‰©å¥–å“ç»“æœæ˜¾ç¤º

### é˜¶æ®µ 4: è·¯ç”±æ³¨å†Œ

9. **æ³¨å†Œæ–°è·¯ç”±**
   - åœ¨ `index.ts` ä¸­æ³¨å†Œæ–°è·¯ç”±
   - æ·»åŠ æƒé™æ£€æŸ¥

---

## ğŸ” æƒé™è®¾è®¡

### ç”¨æˆ·æƒé™
- æŸ¥çœ‹è‡ªå·±çš„å¥–å“ï¼šæ‰€æœ‰ç™»å½•ç”¨æˆ·
- æ— éœ€é¢å¤–æƒé™

### ç®¡ç†å‘˜æƒé™
- æŸ¥çœ‹æ ¸é”€åˆ—è¡¨ï¼š`PRIV_EDIT_SYSTEM` æˆ– `PERM_EDIT_DOMAIN`
- æ‰§è¡Œæ ¸é”€æ“ä½œï¼šåŒä¸Š

---

## ğŸ“Š æ•°æ®åº“ç´¢å¼•å»ºè®®

```typescript
// åœ¨æ’ä»¶åˆå§‹åŒ–æ—¶åˆ›å»ºç´¢å¼•
await ctx.db.collection('lottery.records').createIndex(
  { domainId: 1, prizeType: 1, redeemStatus: 1 },
  { background: true }
);

await ctx.db.collection('lottery.records').createIndex(
  { domainId: 1, uid: 1, prizeType: 1 },
  { background: true }
);

// å¦‚æœä½¿ç”¨ç‹¬ç«‹çš„æ ¸é”€è®°å½•é›†åˆ
await ctx.db.collection('lottery.redemptions').createIndex(
  { domainId: 1, recordId: 1 },
  { background: true }
);
```

---

## ğŸ¯ ç¤ºä¾‹é…ç½®

### ä¿®æ”¹åçš„å¥–é¡¹é…ç½®ç¤ºä¾‹

```typescript
private static readonly PRIZES = [
  { name: '10ç§¯åˆ†', type: 'reward' as const, reward: 10, probability: 0.15 },
  { name: '20ç§¯åˆ†', type: 'reward' as const, reward: 20, probability: 0.10 },
  { name: '50ç§¯åˆ†', type: 'reward' as const, reward: 50, probability: 0.05 },
  { name: '100ç§¯åˆ†', type: 'reward' as const, reward: 100, probability: 0.02 },
  { name: 'è°¢è°¢å‚ä¸', type: 'nothing' as const, reward: 0, probability: 0.30 }, // é™ä½åˆ°30%
  
  // æ–°å¢ 4 ä¸ªå®ç‰©å¥–å“
  { 
    name: 'ç²¾ç¾ç¬”è®°æœ¬', 
    type: 'physical' as const, 
    reward: 0, 
    probability: 0.10,
    physicalPrize: {
      description: 'ç²¾ç¾ç¬”è®°æœ¬ä¸€æœ¬ï¼Œå¯ç”¨äºè®°å½•å­¦ä¹ ç¬”è®°',
      imageUrl: '/public/prizes/notebook.jpg',
    }
  },
  { 
    name: 'å®šåˆ¶æ°´æ¯', 
    type: 'physical' as const, 
    reward: 0, 
    probability: 0.08,
    physicalPrize: {
      description: 'å®šåˆ¶æ°´æ¯ä¸€ä¸ªï¼Œå°æœ‰å¹³å°Logo',
    }
  },
  { 
    name: 'è“ç‰™è€³æœº', 
    type: 'physical' as const, 
    reward: 0, 
    probability: 0.05,
    physicalPrize: {
      description: 'å“ç‰Œè“ç‰™è€³æœºä¸€å‰¯',
      imageUrl: '/public/prizes/earphone.jpg',
    }
  },
  { 
    name: 'å¹³å°å‘¨è¾¹å¤§ç¤¼åŒ…', 
    type: 'physical' as const, 
    reward: 0, 
    probability: 0.02,
    physicalPrize: {
      description: 'åŒ…å«Tæ¤ã€æ°´æ¯ã€ç¬”è®°æœ¬ç­‰å‘¨è¾¹äº§å“çš„å¤§ç¤¼åŒ…',
    }
  },
  
  { name: '5ç§¯åˆ†', type: 'reward' as const, reward: 5, probability: 0.08 },
  { name: '30ç§¯åˆ†', type: 'reward' as const, reward: 30, probability: 0.03 },
  { name: '200ç§¯åˆ†', type: 'reward' as const, reward: 200, probability: 0.01 },
  { name: 'å†æ¥ä¸€æ¬¡', type: 'bonus' as const, reward: 0, probability: 0.01 },
];
```

**æ¦‚ç‡éªŒè¯**: 0.15 + 0.10 + 0.05 + 0.02 + 0.30 + 0.10 + 0.08 + 0.05 + 0.02 + 0.08 + 0.03 + 0.01 + 0.01 = 1.00 âœ…

---

## ğŸš€ API ç«¯ç‚¹è®¾è®¡

### ç”¨æˆ·ç«¯ API

| è·¯ç”± | æ–¹æ³• | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| `/score/lottery/my-prizes` | GET | è·å–æˆ‘çš„å¥–å“åˆ—è¡¨ | ç™»å½•ç”¨æˆ· |
| `/score/lottery/my-prizes` | GET | è·å–æˆ‘çš„å¥–å“ï¼ˆAPIï¼‰ | ç™»å½•ç”¨æˆ· |

### ç®¡ç†å‘˜ç«¯ API

| è·¯ç”± | æ–¹æ³• | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| `/score/lottery/admin/redeem` | GET | æ ¸é”€ç®¡ç†é¡µé¢ | ç®¡ç†å‘˜ |
| `/score/lottery/admin/redeem/list` | GET | è·å–å¾…æ ¸é”€åˆ—è¡¨ | ç®¡ç†å‘˜ |
| `/score/lottery/admin/redeem/redeem` | POST | æ‰§è¡Œæ ¸é”€ | ç®¡ç†å‘˜ |
| `/score/lottery/admin/redeem/cancel` | POST | å–æ¶ˆæ ¸é”€ | ç®¡ç†å‘˜ |
| `/score/lottery/admin/redeem/history` | GET | æ ¸é”€å†å² | ç®¡ç†å‘˜ |

---

## ğŸ“‹ å¾…åŠäº‹é¡¹æ¸…å•

### åç«¯å¼€å‘
- [ ] ä¿®æ”¹ `LotteryGameRecord` æ¥å£ï¼Œæ·»åŠ æ ¸é”€å­—æ®µ
- [ ] ä¿®æ”¹ `LotteryService.PRIZES`ï¼Œæ·»åŠ  4 ä¸ªå®ç‰©å¥–å“
- [ ] ä¿®æ”¹ `LotteryService.playLottery()`ï¼Œå¤„ç†å®ç‰©å¥–å“ç±»å‹
- [ ] åˆ›å»º `LotteryRedemptionService` æœåŠ¡ç±»
- [ ] åˆ›å»º `LotteryRedemptionHandlers` å¤„ç†å™¨
- [ ] æ³¨å†Œæ–°è·¯ç”±åˆ° `index.ts`
- [ ] åˆ›å»ºæ•°æ®åº“ç´¢å¼•

### å‰ç«¯å¼€å‘
- [ ] åˆ›å»º `lottery-my-prizes.page.tsx` ç”¨æˆ·å¥–å“é¡µé¢
- [ ] åˆ›å»º `lottery-redemption-admin.page.tsx` ç®¡ç†å‘˜æ ¸é”€é¡µé¢
- [ ] ä¿®æ”¹ `lottery-game.page.tsx`ï¼Œå¤„ç†å®ç‰©å¥–å“æ˜¾ç¤º
- [ ] åˆ›å»ºå¯¹åº”çš„ HTML æ¨¡æ¿æ–‡ä»¶
- [ ] æ·»åŠ å›½é™…åŒ–æ–‡æœ¬

### æµ‹è¯•
- [ ] æµ‹è¯•æŠ½å¥–æµç¨‹ï¼ˆå®ç‰©å¥–å“ï¼‰
- [ ] æµ‹è¯•æ ¸é”€æµç¨‹
- [ ] æµ‹è¯•æƒé™æ§åˆ¶
- [ ] æµ‹è¯•æ•°æ®ç»Ÿè®¡

---

## ğŸ’¡ æ‰©å±•åŠŸèƒ½å»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **æ ¸é”€äºŒç»´ç **: ç”Ÿæˆå”¯ä¸€äºŒç»´ç ï¼Œç®¡ç†å‘˜æ‰«ç æ ¸é”€
2. **æ ¸é”€é€šçŸ¥**: ç”¨æˆ·ä¸­å¥–åå‘é€é€šçŸ¥
3. **åº“å­˜ç®¡ç†**: å¦‚æœå¥–å“æœ‰åº“å­˜é™åˆ¶

### é•¿æœŸä¼˜åŒ–
1. **æ ¸é”€åœ°ç‚¹ç®¡ç†**: è®¾ç½®å¤šä¸ªæ ¸é”€åœ°ç‚¹
2. **æ ¸é”€æ—¶é—´é™åˆ¶**: è®¾ç½®æ ¸é”€æœ‰æ•ˆæœŸ
3. **æ‰¹é‡æ ¸é”€**: æ”¯æŒæ‰¹é‡æ“ä½œ
4. **æ ¸é”€ç»Ÿè®¡**: ç»Ÿè®¡å„å¥–å“æ ¸é”€ç‡

---

## ğŸ“ æ€»ç»“

æœ¬æ–¹æ¡ˆå®ç°äº†å®Œæ•´çš„å®ç‰©å¥–å“æ ¸é”€åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… **æ•°æ®æ¨¡å‹**: æ‰©å±•äº†å¥–é¡¹ç±»å‹å’Œè®°å½•ç»“æ„
2. âœ… **æ ¸å¿ƒé€»è¾‘**: ä¿®æ”¹æŠ½å¥–æµç¨‹ï¼Œæ”¯æŒå®ç‰©å¥–å“
3. âœ… **æ ¸é”€æœåŠ¡**: å®Œæ•´çš„æ ¸é”€ç®¡ç†åŠŸèƒ½
4. âœ… **ç”¨æˆ·ç•Œé¢**: ç”¨æˆ·æŸ¥çœ‹å¥–å“ã€ç®¡ç†å‘˜æ ¸é”€
5. âœ… **æƒé™æ§åˆ¶**: å®Œå–„çš„æƒé™ç®¡ç†

**é¢„è®¡å¼€å‘æ—¶é—´**: 2-3 å¤©

**ä¼˜å…ˆçº§**: é«˜ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2024å¹´  
**æœ€åæ›´æ–°**: å®ç°æ–¹æ¡ˆè®¾è®¡å®Œæˆ
