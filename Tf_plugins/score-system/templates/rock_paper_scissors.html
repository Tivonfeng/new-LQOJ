{% set page_name = "rock_paper_scissors" %}
{% extends "layout/basic.html" %}
{% block content %}

<!-- React App Mount Point -->
<div id="rps-game-react-app"></div>

<!-- Pass data to React component via global variables -->
<script>
    // 将模板数据传递给React组件
    window.rpsGameData = {
        currentCoins: {{ currentCoins or 0 }},
        canPlay: {{ 'true' if canPlay else 'false' }},
        gameConfig: {
            baseCost: {{ gameConfig.baseCost }},
            winReward: {{ gameConfig.winReward }},
            drawReward: {{ gameConfig.drawReward }},
            streakBonus: {{ gameConfig.streakBonus }},
            winMultiplier: {{ gameConfig.winMultiplier }}
        },
        userStats: {
            totalGames: {{ userStats.totalGames or 0 }},
            wins: {{ userStats.wins or 0 }},
            draws: {{ userStats.draws or 0 }},
            losses: {{ userStats.losses or 0 }},
            netProfit: {{ userStats.netProfit or 0 }},
            currentStreak: {{ userStats.currentStreak or 0 }},
            bestStreak: {{ userStats.bestStreak or 0 }}
        },
        winRate: '{{ winRate }}',
        recentGames: [
            {% for game in recentGames %}
            {
                playerChoice: '{{ game.playerChoice }}',
                aiChoice: '{{ game.aiChoice }}',
                result: '{{ game.result }}',
                netGain: {{ game.netGain }},
                gameTime: '{{ game.time }}'
            }{% if not loop.last %},{% endif %}
            {% endfor %}
        ],
        dailyLimit: {
            remainingPlays: {{ dailyLimit.remainingPlays }},
            maxPlays: {{ dailyLimit.maxPlays }}
        }
    };

    // 传递URL
    window.rpsPlayUrl = '{{ url("rps_play") }}';
    window.rpsStatusUrl = '{{ url("rps_status") }}';
    window.scoreHallUrl = '{{ url("score_hall") }}';
    window.rpsHistoryUrl = '{{ url("rps_history") }}';
    window.transferUrl = '{{ url("wallet") }}';
    {% if handler.user._id %}
    window.currentUserId = '{{ handler.user._id }}';
    {% endif %}
    // 传递用户信息
    window.rpsGameData.udocs = {{ udocsJson|safe }};
</script>

{% endblock %}
