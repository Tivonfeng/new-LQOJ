{% extends "layout/basic.html" %}

{% block content %}
<div class="section typing-stats-page">
  <div class="section__header">
    <h1 class="section__title">
      <span class="icon">üìä</span>
      {{ _('Typing Statistics') }}
    </h1>
    <div class="section__tools">
      <a href="/typing" class="btn btn-primary">
        <span class="icon">‚å®Ô∏è</span>
        {{ _('Back to Practice') }}
      </a>
      <button id="export-data-btn" class="btn btn-outline-secondary">
        <span class="icon">üíæ</span>
        {{ _('Export Data') }}
      </button>
    </div>
  </div>

  <div class="typing-stats-container">
    <!-- Ê¶ÇËßàÂç°Áâá -->
    <div class="stats-overview">
      <div class="overview-card">
        <div class="card-icon">‚ö°</div>
        <div class="card-content">
          <div class="card-title">{{ _('Best WPM') }}</div>
          <div class="card-value">{{ userStats.bestWPM or 0 }}</div>
          <div class="card-change {% if progressData.wmpTrend == 'improving' %}positive{% elif progressData.wmpTrend == 'declining' %}negative{% endif %}">
            {% if progressData.wmpTrend == 'improving' %}‚ÜóÔ∏è {{ _('Improving') }}{% elif progressData.wmpTrend == 'declining' %}‚ÜòÔ∏è {{ _('Declining') }}{% else %}‚û°Ô∏è {{ _('Stable') }}{% endif %}
          </div>
        </div>
      </div>

      <div class="overview-card">
        <div class="card-icon">üéØ</div>
        <div class="card-content">
          <div class="card-title">{{ _('Best Accuracy') }}</div>
          <div class="card-value">{{ userStats.bestAccuracy or 0 }}%</div>
          <div class="card-change {% if progressData.accuracyTrend == 'improving' %}positive{% elif progressData.accuracyTrend == 'declining' %}negative{% endif %}">
            {% if progressData.accuracyTrend == 'improving' %}‚ÜóÔ∏è {{ _('Improving') }}{% elif progressData.accuracyTrend == 'declining' %}‚ÜòÔ∏è {{ _('Declining') }}{% else %}‚û°Ô∏è {{ _('Stable') }}{% endif %}
          </div>
        </div>
      </div>

      <div class="overview-card">
        <div class="card-icon">üí™</div>
        <div class="card-content">
          <div class="card-title">{{ _('Total Practices') }}</div>
          <div class="card-value">{{ userStats.totalPractices or 0 }}</div>
          <div class="card-subtitle">{{ ((userStats.totalTimeSpent or 0) / 60) | round(1) }} {{ _('minutes') }}</div>
        </div>
      </div>

      <div class="overview-card">
        <div class="card-icon">üî•</div>
        <div class="card-content">
          <div class="card-title">{{ _('Longest Streak') }}</div>
          <div class="card-value">{{ userStats.longestStreak or 0 }}</div>
          <div class="card-subtitle">{{ _('days') }}</div>
        </div>
      </div>

      <div class="overview-card">
        <div class="card-icon">‚≠ê</div>
        <div class="card-content">
          <div class="card-title">{{ _('Level') }}</div>
          <div class="card-value">{{ userStats.level or 1 }}</div>
          <div class="card-subtitle">{{ userStats.experiencePoints or 0 }} XP</div>
        </div>
      </div>

      {% if config.scoreIntegration %}
      <div class="overview-card">
        <div class="card-icon">üèÜ</div>
        <div class="card-content">
          <div class="card-title">{{ _('Total Score') }}</div>
          <div class="card-value">{{ userStats.totalScore or 0 }}</div>
          <div class="card-subtitle">{{ _('Rank') }} #{{ userRankings.score or 'N/A' }}</div>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- ÂõæË°®Âå∫Âüü -->
    <div class="stats-charts">
      <div class="chart-container">
        <div class="chart-header">
          <h3>{{ _('Progress Over Time') }}</h3>
          <div class="chart-controls">
            <select id="chart-period" class="form-control form-control-sm">
              <option value="7d">{{ _('Last 7 days') }}</option>
              <option value="30d" selected>{{ _('Last 30 days') }}</option>
              <option value="90d">{{ _('Last 90 days') }}</option>
              <option value="1y">{{ _('Last year') }}</option>
            </select>
          </div>
        </div>
        <div class="chart-content">
          <canvas id="progress-chart" width="800" height="300"></canvas>
        </div>
      </div>

      <div class="chart-container">
        <div class="chart-header">
          <h3>{{ _('Practice Heatmap') }}</h3>
          <div class="heatmap-legend">
            <span>{{ _('Less') }}</span>
            <div class="legend-scale">
              <div class="legend-day level-0"></div>
              <div class="legend-day level-1"></div>
              <div class="legend-day level-2"></div>
              <div class="legend-day level-3"></div>
              <div class="legend-day level-4"></div>
            </div>
            <span>{{ _('More') }}</span>
          </div>
        </div>
        <div class="heatmap-content" id="practice-heatmap">
          <!-- ÁÉ≠ÂäõÂõæÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
        </div>
      </div>
    </div>

    <!-- ËØ¶ÁªÜÁªüËÆ° -->
    <div class="stats-details">
      <div class="details-column">
        <!-- ÁªÉ‰π†ÂéÜÂè≤ -->
        <div class="stats-section">
          <h3>{{ _('Recent Practice History') }}</h3>
          <div class="practice-history-table">
            <table class="table">
              <thead>
                <tr>
                  <th>{{ _('Date') }}</th>
                  <th>{{ _('WPM') }}</th>
                  <th>{{ _('Accuracy') }}</th>
                  <th>{{ _('Time') }}</th>
                  <th>{{ _('Score') }}</th>
                  <th>{{ _('Difficulty') }}</th>
                </tr>
              </thead>
              <tbody>
                {% for record in practiceHistory %}
                <tr>
                  <td>
                    {% if record.createdAt %}
                      {% if record.createdAt.strftime %}
                      {{ record.createdAt.strftime('%m/%d %H:%M') }}
                      {% else %}
                      {{ record.createdAt|string }}
                      {% endif %}
                    {% else %}
                      {{ _('N/A') }}
                    {% endif %}
                  </td>
                  <td>{{ record.result.wpm }}</td>
                  <td>{{ record.result.accuracy }}%</td>
                  <td>{{ (record.result.timeSpent / 60) | round(1) }}m</td>
                  <td>{{ record.scoreEarned }}</td>
                  <td>
                    <span class="difficulty-badge difficulty-{{ record.result.difficulty }}">
                      {{ _(record.result.difficulty|title) }}
                    </span>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="load-more-container">
            <button id="load-more-history" class="btn btn-outline-primary">
              {{ _('Load More History') }}
            </button>
          </div>
        </div>

        <!-- ÈîôËØØÂàÜÊûê -->
        {% if errorAnalysis.mostProblematicChars.length > 0 %}
        <div class="stats-section">
          <h3>{{ _('Error Analysis') }}</h3>
          <div class="error-analysis">
            <h4>{{ _('Most Problematic Characters') }}</h4>
            <div class="error-chars-grid">
              {% for error in errorAnalysis.mostProblematicChars %}
              <div class="error-char-item">
                <div class="char-display">{{ error.character }}</div>
                <div class="char-stats">
                  <div class="error-count">{{ error.errorCount }} {{ _('errors') }}</div>
                  <div class="accuracy-rate">{{ error.accuracy | round(1) }}% {{ _('accuracy') }}</div>
                </div>
              </div>
              {% endfor %}
            </div>
            
            {% if errorAnalysis.improvementSuggestions.length > 0 %}
            <h4>{{ _('Improvement Suggestions') }}</h4>
            <ul class="improvement-suggestions">
              {% for suggestion in errorAnalysis.improvementSuggestions %}
              <li>{{ suggestion }}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>
        </div>
        {% endif %}
      </div>

      <div class="details-column">
        <!-- ÊàêÂ∞±Â±ïÁ§∫ -->
        {% if userStats.achievements.length > 0 %}
        <div class="stats-section">
          <h3>{{ _('Achievements') }} ({{ userStats.achievements.length }})</h3>
          <div class="achievements-grid">
            {% for achievementId in userStats.achievements %}
            <div class="achievement-item earned">
              <div class="achievement-icon">üèÜ</div>
              <div class="achievement-info">
                <div class="achievement-name">{{ _(achievementId + '_name') or achievementId }}</div>
                <div class="achievement-desc">{{ _(achievementId + '_desc') or 'Achievement unlocked!' }}</div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- ÊéíÂêç‰ø°ÊÅØ -->
        <div class="stats-section">
          <h3>{{ _('Your Rankings') }}</h3>
          <div class="rankings-grid">
            <div class="ranking-item">
              <div class="ranking-type">{{ _('WPM Ranking') }}</div>
              <div class="ranking-position">#{{ userRankings.wpm or 'N/A' }}</div>
            </div>
            <div class="ranking-item">
              <div class="ranking-type">{{ _('Accuracy Ranking') }}</div>
              <div class="ranking-position">#{{ userRankings.accuracy or 'N/A' }}</div>
            </div>
            {% if config.scoreIntegration %}
            <div class="ranking-item">
              <div class="ranking-type">{{ _('Score Ranking') }}</div>
              <div class="ranking-position">#{{ userRankings.score or 'N/A' }}</div>
            </div>
            {% endif %}
          </div>
        </div>

        <!-- ÁªÉ‰π†ÂàÜÂ∏É -->
        <div class="stats-section">
          <h3>{{ _('Practice Distribution') }}</h3>
          <div class="distribution-chart">
            <h4>{{ _('By Difficulty') }}</h4>
            <div id="difficulty-distribution" class="distribution-bars">
              <!-- JavaScriptÂä®ÊÄÅÁîüÊàê -->
            </div>
            
            <h4>{{ _('By Text Type') }}</h4>
            <div id="text-type-distribution" class="distribution-bars">
              <!-- JavaScriptÂä®ÊÄÅÁîüÊàê -->
            </div>
          </div>
        </div>

        <!-- ‰∏™‰∫∫ËÆ∞ÂΩï -->
        <div class="stats-section">
          <h3>{{ _('Personal Records') }}</h3>
          <div class="records-list">
            <div class="record-item">
              <span class="record-label">{{ _('Fastest WPM') }}:</span>
              <span class="record-value">{{ userStats.bestWPM or 0 }}</span>
            </div>
            <div class="record-item">
              <span class="record-label">{{ _('Highest Accuracy') }}:</span>
              <span class="record-value">{{ userStats.bestAccuracy or 0 }}%</span>
            </div>
            <div class="record-item">
              <span class="record-label">{{ _('Longest Session') }}:</span>
              <span class="record-value">{{ ((userStats.longestSessionTime or 0) / 60) | round(1) }} {{ _('min') }}</span>
            </div>
            <div class="record-item">
              <span class="record-label">{{ _('Most Practices in Day') }}:</span>
              <span class="record-value">{{ userStats.maxDailyPractices or 0 }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Êï∞ÊçÆÂØºÂá∫Ê®°ÊÄÅÊ°Ü -->
<div id="export-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>{{ _('Export Your Data') }}</h3>
      <button class="modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <div class="export-options">
        <div class="export-format">
          <label>{{ _('Export Format') }}:</label>
          <select id="export-format-select" class="form-control">
            <option value="json">JSON</option>
            <option value="csv">CSV</option>
          </select>
        </div>
        <div class="export-description">
          <p>{{ _('This will download your complete typing practice data including statistics, history, and achievements.') }}</p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button id="download-data" class="btn btn-primary">{{ _('Download') }}</button>
      <button class="btn btn-secondary modal-close">{{ _('Cancel') }}</button>
    </div>
  </div>
</div>

<script>
// ‰º†ÈÄíÊï∞ÊçÆÂà∞ÂâçÁ´ØÁªÑ‰ª∂
window.TypingStatsData = {
  userStats: {{ userStats | dump | safe }},
  practiceHistory: {{ practiceHistory | dump | safe }},
  heatmapData: {{ heatmapData | dump | safe }},
  progressData: {{ progressData | dump | safe }},
  errorAnalysis: {{ errorAnalysis | dump | safe }},
  userRankings: {{ userRankings | dump | safe }},
  config: {{ config | dump | safe }}
};
</script>
{% endblock %}

{% block script %}
<!-- ÁªüËÆ°È°µÈù¢ReactÁªÑ‰ª∂‰ºöÂú®ËøôÈáåÊåÇËΩΩ -->
<div id="typing-stats-app-mount-point"></div>

<style>
/* Design System Variables */
:root {
    --primary-color: #6366f1;
    --primary-dark: #4f46e5;
    --secondary-color: #06d6a0;
    --accent-color: #f59e0b;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --error-color: #ef4444;
    --info-color: #3b82f6;
    
    --text-primary: #111827;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
    
    --bg-primary: #ffffff;
    --bg-secondary: #f9fafb;
    --bg-tertiary: #f3f4f6;
    
    --border-color: #e5e7eb;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
    
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    
    --spacing-1: 4px;
    --spacing-2: 8px;
    --spacing-3: 12px;
    --spacing-4: 16px;
    --spacing-5: 20px;
    --spacing-6: 24px;
    --spacing-8: 32px;
    --spacing-10: 40px;
    --spacing-12: 48px;
}

/* Page Layout */
.typing-stats-page {
    background: var(--bg-secondary);
    min-height: 100vh;
    padding: var(--spacing-6);
}

.section__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-8);
    padding: var(--spacing-6);
    background: var(--bg-primary);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
}

.section__title {
    font-size: 2.25rem;
    font-weight: 800;
    color: var(--text-primary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
}

.section__title .icon {
    font-size: 2rem;
}

.section__tools {
    display: flex;
    gap: var(--spacing-3);
}

/* Container */
.typing-stats-container {
    max-width: 1400px;
    margin: 0 auto;
}

/* Stats Overview Cards */
.stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-6);
    margin-bottom: var(--spacing-8);
}

.overview-card {
    background: var(--bg-primary);
    border-radius: var(--radius-xl);
    padding: var(--spacing-6);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    gap: var(--spacing-4);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.overview-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
}

.overview-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.card-icon {
    font-size: 2.5rem;
    min-width: 60px;
    text-align: center;
}

.card-content {
    flex: 1;
}

.card-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: var(--spacing-1);
}

.card-value {
    font-size: 2rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: var(--spacing-1);
}

.card-subtitle {
    font-size: 0.875rem;
    color: var(--text-muted);
}

.card-change {
    font-size: 0.875rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--spacing-1);
}

.card-change.positive {
    color: var(--success-color);
}

.card-change.negative {
    color: var(--error-color);
}

/* Charts Section */
.stats-charts {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-8);
    margin-bottom: var(--spacing-8);
}

.chart-container {
    background: var(--bg-primary);
    border-radius: var(--radius-xl);
    padding: var(--spacing-6);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
}

.chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-6);
}

.chart-header h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
}

.chart-controls {
    display: flex;
    gap: var(--spacing-3);
}

.chart-content {
    min-height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Heatmap */
.heatmap-legend {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.legend-scale {
    display: flex;
    gap: var(--spacing-1);
}

.legend-day {
    width: 12px;
    height: 12px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-color);
}

.legend-day.level-0 { background: var(--bg-tertiary); }
.legend-day.level-1 { background: rgba(6, 214, 160, 0.2); }
.legend-day.level-2 { background: rgba(6, 214, 160, 0.4); }
.legend-day.level-3 { background: rgba(6, 214, 160, 0.6); }
.legend-day.level-4 { background: rgba(6, 214, 160, 0.8); }

.heatmap-content {
    margin-top: var(--spacing-4);
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-4);
}

/* Details Section */
.stats-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-8);
}

.details-column {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-6);
}

.stats-section {
    background: var(--bg-primary);
    border-radius: var(--radius-xl);
    padding: var(--spacing-6);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
}

.stats-section h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0 0 var(--spacing-4) 0;
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
}

/* Practice History Table */
.practice-history-table {
    overflow-x: auto;
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table th,
.table td {
    padding: var(--spacing-3) var(--spacing-2);
    text-align: left;
    border-bottom: 1px solid var(--border-color);
}

.table th {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    background: var(--bg-secondary);
}

.table td {
    color: var(--text-primary);
}

.difficulty-badge {
    display: inline-block;
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.difficulty-beginner {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}

.difficulty-intermediate {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning-color);
}

.difficulty-advanced {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error-color);
}

.difficulty-expert {
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary-color);
}

.load-more-container {
    text-align: center;
    margin-top: var(--spacing-4);
}

/* Error Analysis */
.error-analysis h4 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: var(--spacing-4) 0 var(--spacing-3) 0;
}

.error-chars-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: var(--spacing-3);
    margin-bottom: var(--spacing-4);
}

.error-char-item {
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    padding: var(--spacing-3);
    text-align: center;
    border: 1px solid var(--border-color);
}

.char-display {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--error-color);
    margin-bottom: var(--spacing-2);
    font-family: monospace;
    background: rgba(239, 68, 68, 0.1);
    border-radius: var(--radius-md);
    padding: var(--spacing-2);
}

.char-stats {
    font-size: 0.75rem;
}

.error-count {
    color: var(--error-color);
    font-weight: 600;
}

.accuracy-rate {
    color: var(--text-muted);
}

.improvement-suggestions {
    list-style: none;
    padding: 0;
}

.improvement-suggestions li {
    padding: var(--spacing-2) 0;
    color: var(--text-secondary);
    border-bottom: 1px solid var(--border-color);
}

.improvement-suggestions li:last-child {
    border-bottom: none;
}

.improvement-suggestions li::before {
    content: 'üí°';
    margin-right: var(--spacing-2);
}

/* Achievements */
.achievements-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-3);
}

.achievement-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
    padding: var(--spacing-3);
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
}

.achievement-item.earned {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
    border-color: rgba(245, 158, 11, 0.3);
}

.achievement-icon {
    font-size: 1.5rem;
}

.achievement-name {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-1);
}

.achievement-desc {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

/* Rankings */
.rankings-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-3);
}

.ranking-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-3);
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
}

.ranking-type {
    font-weight: 600;
    color: var(--text-primary);
}

.ranking-position {
    font-size: 1.25rem;
    font-weight: 800;
    color: var(--secondary-color);
}

/* Distribution Charts */
.distribution-bars {
    margin-bottom: var(--spacing-4);
}

.distribution-bars h4 {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin: var(--spacing-3) 0 var(--spacing-2) 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Records List */
.records-list {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-3);
}

.record-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-3);
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
}

.record-label {
    font-weight: 600;
    color: var(--text-primary);
}

.record-value {
    font-weight: 800;
    color: var(--secondary-color);
}

/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: var(--bg-primary);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xl);
    max-width: 500px;
    width: 90%;
    max-height: 90%;
    overflow: hidden;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-6);
    border-bottom: 1px solid var(--border-color);
}

.modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--text-muted);
    cursor: pointer;
    padding: 0;
    line-height: 1;
}

.modal-close:hover {
    color: var(--text-primary);
}

.modal-body {
    padding: var(--spacing-6);
}

.modal-footer {
    display: flex;
    gap: var(--spacing-3);
    justify-content: flex-end;
    padding: var(--spacing-6);
    border-top: 1px solid var(--border-color);
    background: var(--bg-secondary);
}

/* Export Options */
.export-options {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-4);
}

.export-format label {
    display: block;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-2);
}

.export-description {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

/* Heatmap Grid Layout */
.heatmap-grid {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
}

.month-labels {
    display: flex;
    position: relative;
    height: 20px;
    font-size: 0.75rem;
    color: var(--text-muted);
}

.month-label {
    position: absolute;
    font-weight: 600;
}

.weekday-labels {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-1);
    margin-right: var(--spacing-2);
    width: 30px;
}

.weekday-label {
    height: 12px;
    font-size: 0.75rem;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    font-weight: 500;
}

.heatmap-days {
    display: grid;
    grid-template-columns: repeat(53, 12px);
    grid-template-rows: repeat(7, 12px);
    gap: 2px;
    grid-auto-flow: column;
}

.heatmap-day {
    width: 12px;
    height: 12px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-color);
    cursor: pointer;
    transition: all 0.2s ease;
}

.heatmap-day:hover {
    transform: scale(1.1);
    border-color: var(--secondary-color);
}

.heatmap-day.level-0 { 
    background: var(--bg-tertiary); 
}

.heatmap-day.level-1 { 
    background: rgba(6, 214, 160, 0.2); 
}

.heatmap-day.level-2 { 
    background: rgba(6, 214, 160, 0.4); 
}

.heatmap-day.level-3 { 
    background: rgba(6, 214, 160, 0.6); 
}

.heatmap-day.level-4 { 
    background: rgba(6, 214, 160, 0.8); 
}

/* Distribution Charts */
.distribution-bar {
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
    padding: var(--spacing-2) 0;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
}

.distribution-bar:last-child {
    border-bottom: none;
}

.bar-label {
    min-width: 80px;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
    text-transform: capitalize;
}

.bar-track {
    flex: 1;
    height: 20px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
    overflow: hidden;
    position: relative;
}

.bar-fill {
    height: 100%;
    border-radius: var(--radius-md);
    transition: width 0.8s ease;
}

.bar-value {
    min-width: 80px;
    text-align: right;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
}

/* Difficulty bar colors */
.bar-fill.difficulty-beginner {
    background: linear-gradient(135deg, var(--success-color), rgba(16, 185, 129, 0.8));
}

.bar-fill.difficulty-intermediate {
    background: linear-gradient(135deg, var(--warning-color), rgba(245, 158, 11, 0.8));
}

.bar-fill.difficulty-advanced {
    background: linear-gradient(135deg, var(--error-color), rgba(239, 68, 68, 0.8));
}

.bar-fill.difficulty-expert {
    background: linear-gradient(135deg, var(--primary-color), rgba(99, 102, 241, 0.8));
}

.bar-fill.difficulty-unknown {
    background: linear-gradient(135deg, var(--text-muted), rgba(156, 163, 175, 0.8));
}

/* Text type bar colors */
.bar-fill.text-type-english {
    background: linear-gradient(135deg, #3b82f6, rgba(59, 130, 246, 0.8));
}

.bar-fill.text-type-chinese {
    background: linear-gradient(135deg, #f59e0b, rgba(245, 158, 11, 0.8));
}

.bar-fill.text-type-code {
    background: linear-gradient(135deg, #8b5cf6, rgba(139, 92, 246, 0.8));
}

.bar-fill.text-type-mixed {
    background: linear-gradient(135deg, #06d6a0, rgba(6, 214, 160, 0.8));
}

.bar-fill.text-type-unknown {
    background: linear-gradient(135deg, var(--text-muted), rgba(156, 163, 175, 0.8));
}

/* Chart Simple Fallback */
.chart-simple {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 300px;
    padding: var(--spacing-6);
}

.simple-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--spacing-6);
    margin-bottom: var(--spacing-4);
    width: 100%;
    max-width: 600px;
}

.simple-stat {
    text-align: center;
    padding: var(--spacing-4);
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
}

.simple-stat .stat-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: var(--spacing-2);
    font-weight: 600;
}

.simple-stat .stat-value {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--secondary-color);
}

.chart-note {
    color: var(--text-muted);
    font-style: italic;
}

/* Chart Loading State */
.chart-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 300px;
    color: var(--text-muted);
    font-size: 1rem;
}

.chart-loading::before {
    content: 'üìä';
    font-size: 2rem;
    margin-right: var(--spacing-2);
    animation: pulse 2s ease-in-out infinite alternate;
}

@keyframes pulse {
    from { opacity: 0.6; }
    to { opacity: 1; }
}

/* Empty State for Charts */
.chart-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 200px;
    color: var(--text-muted);
    text-align: center;
}

.chart-empty-icon {
    font-size: 3rem;
    margin-bottom: var(--spacing-4);
    opacity: 0.6;
}

.chart-empty-text {
    font-size: 1rem;
    margin-bottom: var(--spacing-2);
}

.chart-empty-subtext {
    font-size: 0.875rem;
    opacity: 0.8;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .stats-details {
        grid-template-columns: 1fr;
    }
    
    .stats-overview {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
}

@media (max-width: 768px) {
    .typing-stats-page {
        padding: var(--spacing-4);
    }
    
    .section__header {
        flex-direction: column;
        gap: var(--spacing-4);
        text-align: center;
    }
    
    .section__title {
        font-size: 1.875rem;
    }
    
    .stats-overview {
        grid-template-columns: 1fr;
    }
    
    .overview-card {
        padding: var(--spacing-4);
    }
    
    .card-value {
        font-size: 1.75rem;
    }
    
    .stats-section {
        padding: var(--spacing-4);
    }
    
    .table th,
    .table td {
        padding: var(--spacing-2);
        font-size: 0.875rem;
    }
    
    .error-chars-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    }
    
    .heatmap-days {
        grid-template-columns: repeat(26, 12px);
    }
    
    .simple-stats {
        grid-template-columns: 1fr;
        gap: var(--spacing-3);
    }
}

@media (max-width: 640px) {
    .heatmap-days {
        grid-template-columns: repeat(18, 10px);
        grid-template-rows: repeat(7, 10px);
        gap: 1px;
    }
    
    .heatmap-day {
        width: 10px;
        height: 10px;
    }
    
    .weekday-label {
        font-size: 0.625rem;
    }
    
    .distribution-bar {
        flex-direction: column;
        align-items: stretch;
        gap: var(--spacing-2);
    }
    
    .bar-label,
    .bar-value {
        min-width: auto;
        text-align: left;
    }
}

@media (max-width: 480px) {
    .section__tools {
        flex-direction: column;
        width: 100%;
    }
    
    .chart-header {
        flex-direction: column;
        gap: var(--spacing-3);
        align-items: stretch;
    }
    
    .modal-content {
        width: 95%;
        margin: var(--spacing-4);
    }
    
    .modal-footer {
        flex-direction: column;
    }
}
</style>
{% endblock %}